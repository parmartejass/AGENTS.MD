version: 1
ssot_owner: AGENTS.md
update_trigger: task profile signals or injected doc sets change
description: >-
  Deterministic context-injection manifest for agents/tools. This is the single source of truth
  for mapping task signals to which supporting docs/playbooks should be loaded alongside AGENTS.md.

default_inject:
  - "AGENTS.md"
  - "docs/agents/05-context-retrieval.md"

injection_mode: union # union | first_match

fallback_inject:
  - "docs/agents/10-repo-discovery.md"
  - "docs/agents/30-logging-errors.md"

semantic_queries:
  # Pre-defined queries agents can use for embedding-based search when a profile matches.
  governance_improvement:
    - "Where are governance policies and core principles defined?"
    - "How is context injection for governance docs configured?"
  automation_loop:
    - "Where are the automation loop templates and runbooks?"
    - "How are the nightly review and implement steps defined?"
  excel_automation:
    - "Where is Excel file processing handled in this repo?"
    - "Where are workbook/sheet constants and validation rules defined?"
  excel_com:
    - "How is Excel COM lifecycle managed in this repo?"
    - "Where is the Excel quit/kill fallback implemented?"
  gui_task:
    - "How is GUI thread safety enforced?"
    - "Where is the queue/drain pattern implemented?"
  dual_entry_template:
    - "How does the CLI vs GUI entry dispatcher work?"
    - "Where are workflow scenarios registered?"
  bugfix:
    - "Where is the failing functionality implemented?"
    - "What SSOT owns this behavior?"
  io_batch:
    - "Where is high-volume file I/O handled in this repo?"
    - "What SSOT owns batching/chunking/caching for file processing?"
  pdf_task:
    - "Where is PDF merging handled in this repo?"
    - "How is merged PDF integrity validated (page count, IDs, size checks)?"
    - "Which PDF backend(s) are used and how is fallback handled?"
  perf_hotspots:
    - "Where are known performance hotspots handled in this repo?"
    - "What SSOT owns caching/batching for the slow path?"

profiles:
  excel_automation:
    detect:
      keywords:
        - "excel"
        - "workbook"
        - ".xlsx"
        - ".xlsm"
        - ".xls"
        - "openpyxl"
        - "xlsxwriter"
        - "read_excel"
        - "to_excel"
        - "xlwings"
      code_patterns:
        - "Excel.Application"
        - "xlwings"
        - "openpyxl"
        - "load_workbook"
        - "read_excel"
        - "to_excel"
        - "ExcelWriter"
        - "xlsxwriter"
      file_globs:
        - "*.xlsx"
        - "*.xlsm"
        - "*.xls"
    inject:
      - "docs/agents/40-config-constants.md"
      - "docs/agents/30-logging-errors.md"
      - "docs/agents/70-io-data-integrity.md"
      - "docs/agents/playbooks/excel-task-template.md"

  excel_com:
    detect:
      keywords:
        - "Excel.Application"
        - "xlwings"
        - "excel com"
        - "win32com"
        - "Dispatch"
      code_patterns:
        - "Excel.Application"
        - "xlwings"
        - "win32com.client"
        - "Dispatch("
      file_globs: []
    inject:
      - "docs/agents/50-excel-com-lifecycle.md"

  gui_task:
    detect:
      keywords:
        - "gui"
        - "user interface"
        - "ui thread"
        - "tkinter"
        - "customtkinter"
        - "ttk"
        - "mainloop"
        - "after("
      code_patterns:
        - "tkinter"
        - "customtkinter"
        - "ttk"
        - "mainloop("
        - "after("
      file_globs: []
    inject:
      - "docs/agents/60-gui-threading.md"
      - "docs/agents/30-logging-errors.md"
      - "docs/agents/playbooks/gui-task-template.md"

  io_batch:
    detect:
      keywords:
        - "csv"
        - ".csv"
        - "tsv"
        - ".tsv"
        - "json"
        - ".json"
        - "jsonl"
        - "ndjson"
        - "parquet"
        - ".parquet"
        - "feather"
        - ".feather"
        - "pyarrow"
        - "polars"
        - "etl"
        - "ingest"
        - "bulk"
        - "chunk"
        - "gzip"
        - ".gz"
        - ".zip"
        - "archive"
        - "extract"
        - "glob("
        - "os.walk"
      code_patterns:
        - "read_csv"
        - "to_csv"
        - "read_json"
        - "to_json"
        - "read_parquet"
        - "to_parquet"
        - "json.load"
        - "json.dump"
        - "csv.DictReader"
        - "csv.writer"
        - "Path.glob"
        - "rglob("
        - "os.walk"
        - "gzip.open"
        - "zipfile.ZipFile"
        - "tarfile.open"
      file_globs:
        - "*.csv"
        - "*.tsv"
        - "*.json"
        - "*.jsonl"
        - "*.ndjson"
        - "*.parquet"
        - "*.feather"
        - "*.gz"
        - "*.zip"
        - "*.tar"
        - "*.tgz"
    inject:
      - "docs/agents/70-io-data-integrity.md"
      - "docs/agents/80-testing-real-files.md"
      - "docs/agents/30-logging-errors.md"
      - "docs/agents/40-config-constants.md"
      - "docs/agents/playbooks/io-batch-task-template.md"

  pdf_task:
    detect:
      keywords:
        - "pdf"
        - ".pdf"
        - "pypdf2"
        - "pypdf"
        - "pymupdf"
        - "fitz"
        - "pdfwriter"
        - "pdfreader"
      code_patterns:
        - "PdfReader"
        - "PdfWriter"
        - "fitz.open"
        - "insert_pdf"
        - "merge_pdfs"
      file_globs:
        - "*.pdf"
        - "**/pdf/**"
        - "**/merger.py"
        - "**/*merge*.py"
    inject:
      - "docs/agents/70-io-data-integrity.md"
      - "docs/agents/30-logging-errors.md"
      - "docs/agents/80-testing-real-files.md"
      - "docs/agents/40-config-constants.md"
      - "docs/agents/playbooks/pdf-task-template.md"

  perf_hotspots:
    detect:
      keywords:
        - "iterrows"
        - "itertuples"
        - "cell-by-cell"
        - "per-cell"
        - "nested loop"
      code_patterns:
        - "iterrows("
        - "itertuples("
        - ".Cells("
        - ".cell("
      file_globs: []
    inject:
      - "docs/agents/playbooks/perf-hotspots-template.md"

  dual_entry_template:
    detect:
      keywords:
        - "dual-entry"
        - "dual entry"
        - "entry dispatcher"
        - "__main__.py"
        - "cli"
        - "gui"
        - "scenario"
        - "scenarios"
        - "pytest"
        - "unittest"
      code_patterns:
        - "run_job("
        - "python -m"
      file_globs: []
    inject:
      - "docs/agents/85-dual-entry-template.md"
      - "docs/agents/workflow-registry.md"
      - "docs/agents/80-testing-real-files.md"
      - "docs/agents/60-gui-threading.md"
      - "docs/agents/30-logging-errors.md"
      - "docs/agents/40-config-constants.md"

  bugfix:
    detect:
      keywords:
        - "bug"
        - "bugfix"
        - "regression"
        - "failing"
        - "error"
        - "exception"
        - "crash"
      code_patterns: []
      file_globs: []
    inject:
      - "docs/agents/10-repo-discovery.md"
      - "docs/agents/30-logging-errors.md"
      - "docs/agents/playbooks/bugfix-template.md"

  ai_prompt_authoring:
    detect:
      keywords:
        - "prompt"
        - "prompting"
        - "copilot"
        - "claude"
        - "cursor"
        - "assistant"
        - "template"
      code_patterns: []
      file_globs: []
    inject:
      - "docs/agents/playbooks/ai-coding-prompt-template.md"

  project_docs:
    detect:
      keywords:
        - "docs"
        - "documentation"
        - "readme"
        - "architecture"
        - "goal"
        - "rules"
        - "runbook"
        - "playbook"
        - "adr"
      code_patterns: []
      file_globs:
        - "README.md"
        - "docs/project/*.md"
        - "docs/project/**/*.md"
    inject:
      - "docs/agents/25-docs-ssot-policy.md"
      - "docs/agents/20-sources-of-truth-map.md"
      - "docs/agents/playbooks/project-docs-template.md"

  automation_loop:
    detect:
      keywords:
        - "automation loop"
        - "nightly"
        - "compound"
        - "auto-compound"
        - "agent loop"
        - "autonomous"
        - "task scheduler"
        - "launchd"
        - "cron"
        - "caffeinate"
        - "priority report"
      code_patterns: []
      file_globs:
        - "templates/automation-loop/**"
        - "**/automation/**"
        - "**/automation-loop/**"
    inject:
      - "docs/agents/automation/nightly-compound-loop.md"
      - "docs/agents/playbooks/governance-learnings-template.md"

  governance_improvement:
    detect:
      keywords:
        - "governance"
        - "agents-manifest"
        - "context injection"
        - "ssot"
        - "docs ssot"
        - "playbook"
        - "governance learnings"
        - "session recap"
        - "council review"
        - "post-session"
        - "retrospective"
      code_patterns: []
      file_globs:
        - "agents-manifest.yaml"
        - "docs/agents/*.md"
        - "docs/agents/playbooks/*.md"
        - "docs/agents/skills/*.md"
    inject:
      - "docs/agents/00-principles.md"
      - "docs/agents/20-sources-of-truth-map.md"
      - "docs/agents/25-docs-ssot-policy.md"
      - "docs/agents/05-context-retrieval.md"
      - "docs/agents/15-stuck-in-loop-generate-fresh-restart-prompt.md"
      - "docs/agents/playbooks/governance-learnings-template.md"

  skills_task:
    detect:
      keywords:
        - "cursor skill"
        - "codex skill"
        - "claude skill"
        - "skill standard"
        - "skill standards"
        - "skills ssot"
        - "platform adapter"
        - "skill adapter"
      code_patterns: []
      file_globs:
        - "docs/agents/skills/*.md"
    inject:
      - "docs/agents/skills/00-skill-standards.md"
      - "docs/agents/skills/10-platform-adapters.md"

  stuck_loop_reset:
    detect:
      signals:
        - "repeated_failure_same_root_cause_twice"
        - "verification_contradicts_claim"
    inject:
      - "docs/agents/15-stuck-in-loop-generate-fresh-restart-prompt.md"
